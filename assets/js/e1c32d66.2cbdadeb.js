"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[19164],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return h}});var i=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),s=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},d=function(e){var n=s(e.components);return i.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},p=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=s(t),h=r,m=p["".concat(l,".").concat(h)]||p[h]||u[h]||o;return t?i.createElement(m,a(a({ref:n},d),{},{components:t})):i.createElement(m,a({ref:n},d))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,a=new Array(o);a[0]=p;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,a[1]=c;for(var s=2;s<o;s++)a[s]=t[s];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}p.displayName="MDXCreateElement"},90834:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return c},metadata:function(){return s},toc:function(){return u}});var i=t(83117),r=t(80102),o=(t(67294),t(3905)),a=["components"],c={sidebar_position:90,title:"Create Index in Background"},l=void 0,s={unversionedId:"collections/indexing/create-index-in-background",id:"collections/indexing/create-index-in-background",title:"Create Index in Background",description:'Creating new indexes is by default done under an exclusive collection lock. This means that the collection (or the respective shards) are not available for write operations as long as the index is created. This "foreground" index creation can be undesirable, if you have to perform it on a live system without a dedicated maintenance window.',source:"@site/docs/collections/indexing/create-index-in-background.md",sourceDirName:"collections/indexing",slug:"/collections/indexing/create-index-in-background",permalink:"/docs/collections/indexing/create-index-in-background",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/master/docs/collections/indexing/create-index-in-background.md",tags:[],version:"current",sidebarPosition:90,frontMatter:{sidebar_position:90,title:"Create Index in Background"},sidebar:"tutorialSidebar",previous:{title:"TTL Indexes",permalink:"/docs/collections/indexing/ttl-indexes"},next:{title:"Troubleshoot Indexes",permalink:"/docs/collections/indexing/troubleshoot-indexes"}},d={},u=[{value:"Create in UI",id:"create-in-ui",level:2},{value:"Create with API",id:"create-with-api",level:2},{value:"Behavior",id:"behavior",level:2},{value:"Performance",id:"performance",level:2}],p={toc:u};function h(e){var n=e.components,t=(0,r.Z)(e,a);return(0,o.kt)("wrapper",(0,i.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,'Creating new indexes is by default done under an exclusive collection lock. This means that the collection (or the respective shards) are not available for write operations as long as the index is created. This "foreground" index creation can be undesirable, if you have to perform it on a live system without a dedicated maintenance window.'),(0,o.kt)("p",null,'Indexes can also be created in "background", not using an exclusive lock during the entire index creation. The collection remains basically available, so that other CRUD operations can run on the collection while the index is being created. This can be achieved by setting the ',(0,o.kt)("em",{parentName:"p"},"inBackground")," attribute when creating an index."),(0,o.kt)("h2",{id:"create-in-ui"},"Create in UI"),(0,o.kt)("p",null,"When creating indexes in the UI, select the ",(0,o.kt)("strong",{parentName:"p"},"Create in background")," checkbox to create the index in the background. Refer to the specific create index topic for more information."),(0,o.kt)("h2",{id:"create-with-api"},"Create with API"),(0,o.kt)("p",null,"To create an index in the background, just specify ",(0,o.kt)("inlineCode",{parentName:"p"},"inBackground: true"),", like in the following examples:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cURL"},'// create the hash index in the background\ncurl -X \'POST\' \'https://api-gdn.eng.macrometa.io/_fabric/_system/_api/index/hash?collection=collectionName\' \\\n -H \'Authorization: bearer <token>\'                                                                        \\\n -d \'{ "type": "hash", "fields": [ "value" ], "unique": false, "inBackground": true }\'\n \ncurl -X \'POST\' \'https://api-gdn.eng.macrometa.io/_fabric/_system/_api/index/hash?collection=collectionName\' \\\n -H \'Authorization: bearer <token>\'                                                                        \\\n -d \'{ "type": "hash", "fields": [ "email" ], "unique": true, "inBackground": true }\'\n \n \n// skiplist indexes work also of course\ncurl -X \'POST\' \'https://api-gdn.eng.macrometa.io/_fabric/_system/_api/index/skiplist?collection=collectionName\' \\\n -H \'Authorization: bearer <token>\'                                                                            \\\n -d \'{ "type": "skiplist", "fields": [ "abc", "def" ], "unique": true, "inBackground": true }\'\n\ncurl -X \'POST\' \'https://api-gdn.eng.macrometa.io/_fabric/_system/_api/index/skiplist?collection=collectionName\' \\\n -H \'Authorization: bearer <token>\'                                                                            \\\n -d \'{ "type": "skiplist", "fields": [ "abc", "def" ], "sparse": true, "inBackground": true }\'\n\n// Also supported on fulltext and Geo indexes\ncurl -X \'POST\' \'https://api-gdn.eng.macrometa.io/_fabric/_system/_api/index/fulltext?collection=collectionName\' \\\n -H \'Authorization: bearer <token>\'                                                                            \\\n -d \'{ "type": "fulltext", "fields": [ "text" ], "minLength": 4, "inBackground": true }\'\n \ncurl -X \'POST\' \'https://api-gdn.eng.macrometa.io/_fabric/_system/_api/index/geo?collection=collectionName\' \\\n -H \'Authorization: bearer <token>\'                                                                            \\\n -d \'{ "type": "geo", "fields": [ "latitude", "longitude" ], "minLength": 4, "inBackground": true }\'\n')),(0,o.kt)("h2",{id:"behavior"},"Behavior"),(0,o.kt)("p",null,"Indexes that are still in the build process will not be visible via the GDN APIs. Nevertheless it is not possible to create the same index twice via the ",(0,o.kt)("em",{parentName:"p"},"ensureIndex")," API while an index is still begin created. AQL queries also will not use these indexes until the index reports back as fully created. Note that the initial ",(0,o.kt)("em",{parentName:"p"},"ensureIndex")," call or HTTP request will still block until the index is completely ready. Existing single-threaded client programs can thus safely set the ",(0,o.kt)("em",{parentName:"p"},"inBackground")," option to ",(0,o.kt)("em",{parentName:"p"},"true")," and continue to work as before."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Should you be building an index in the background you cannot rename or drop the collection. These operations will block until the index creation is finished. This is equally the case with foreground indexing.")),(0,o.kt)("h2",{id:"performance"},"Performance"),(0,o.kt)("p",null,'Background index creation might be slower than the "foreground" index creation and require more RAM. Under a write heavy load (specifically many remove, update or replace operations), the background index creation needs to keep a list of removed documents in RAM. This might become unsustainable if this list grows to tens of millions of entries.'),(0,o.kt)("p",null,"Building an index is always a write heavy operation (internally), it is always a good idea to build indexes during times with less load."))}h.isMDXComponent=!0}}]);