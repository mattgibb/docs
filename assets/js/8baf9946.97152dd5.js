"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9349],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return d}});var a=t(67294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,s=function(e,n){if(null==e)return{};var t,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},m=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,s=e.mdxType,r=e.originalType,l=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),p=c(t),d=s,g=p["".concat(l,".").concat(d)]||p[d]||u[d]||r;return t?a.createElement(g,o(o({ref:n},m),{},{components:t})):a.createElement(g,o({ref:n},m))}));function d(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var r=t.length,o=new Array(r);o[0]=p;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:s,o[1]=i;for(var c=2;c<r;c++)o[c]=t[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},85162:function(e,n,t){t.d(n,{Z:function(){return o}});var a=t(67294),s=t(34334),r="tabItem_Ymn6";function o(e){var n=e.children,t=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",className:(0,s.Z)(r,o),hidden:t},n)}},65488:function(e,n,t){t.d(n,{Z:function(){return d}});var a=t(83117),s=t(67294),r=t(34334),o=t(72389),i=t(67392),l=t(7094),c=t(12466),m="tabList__CuJ",u="tabItem_LNqP";function p(e){var n,t,o=e.lazy,p=e.block,d=e.defaultValue,g=e.values,h=e.groupId,b=e.className,f=s.Children.map(e.children,(function(e){if((0,s.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),y=null!=g?g:f.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),k=(0,i.l)(y,(function(e,n){return e.value===n.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var v=null===d?d:null!=(n=null!=d?d:null==(t=f.find((function(e){return e.props.default})))?void 0:t.props.value)?n:f[0].props.value;if(null!==v&&!y.some((function(e){return e.value===v})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+y.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var w=(0,l.U)(),N=w.tabGroupChoices,_=w.setTabGroupChoices,x=(0,s.useState)(v),S=x[0],T=x[1],E=[],C=(0,c.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var I=N[h];null!=I&&I!==S&&y.some((function(e){return e.value===I}))&&T(I)}var A=function(e){var n=e.currentTarget,t=E.indexOf(n),a=y[t].value;a!==S&&(C(n),T(a),null!=h&&_(h,String(a)))},O=function(e){var n,t=null;switch(e.key){case"ArrowRight":var a,s=E.indexOf(e.currentTarget)+1;t=null!=(a=E[s])?a:E[0];break;case"ArrowLeft":var r,o=E.indexOf(e.currentTarget)-1;t=null!=(r=E[o])?r:E[E.length-1]}null==(n=t)||n.focus()};return s.createElement("div",{className:(0,r.Z)("tabs-container",m)},s.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":p},b)},y.map((function(e){var n=e.value,t=e.label,o=e.attributes;return s.createElement("li",(0,a.Z)({role:"tab",tabIndex:S===n?0:-1,"aria-selected":S===n,key:n,ref:function(e){return E.push(e)},onKeyDown:O,onFocus:A,onClick:A},o,{className:(0,r.Z)("tabs__item",u,null==o?void 0:o.className,{"tabs__item--active":S===n})}),null!=t?t:n)}))),o?(0,s.cloneElement)(f.filter((function(e){return e.props.value===S}))[0],{className:"margin-top--md"}):s.createElement("div",{className:"margin-top--md"},f.map((function(e,n){return(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==S})}))))}function d(e){var n=(0,o.Z)();return s.createElement(p,(0,a.Z)({key:String(n)},e))}},300:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return m},default:function(){return h},frontMatter:function(){return c},metadata:function(){return u},toc:function(){return d}});var a=t(83117),s=t(80102),r=(t(67294),t(3905)),o=t(65488),i=t(85162),l=["components"],c={sidebar_position:1,title:"Quickstart"},m=void 0,u={unversionedId:"streams/quickstart",id:"streams/quickstart",title:"Quickstart",description:"This article is an introduction to using streams with pyC8 and jsC8 SDKs.",source:"@site/docs/streams/quickstart.md",sourceDirName:"streams",slug:"/streams/quickstart",permalink:"/docs/streams/quickstart",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/master/docs/streams/quickstart.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Quickstart"},sidebar:"tutorialSidebar",previous:{title:"Streams",permalink:"/docs/streams/"},next:{title:"Using Rest APIs",permalink:"/docs/streams/tutorials/using_rest_api"}},p={},d=[{value:"Credentials",id:"credentials",level:2},{value:"Installation",id:"installation",level:2},{value:"Connect to GDN",id:"connect-to-gdn",level:2},{value:"Get GeoFabric Details",id:"get-geofabric-details",level:2},{value:"Create Global &amp; Local Streams",id:"create-global--local-streams",level:2},{value:"Publish Messages",id:"publish-messages",level:2},{value:"Subscribe to Stream",id:"subscribe-to-stream",level:2},{value:"Full demo quickstart file",id:"full-demo-quickstart-file",level:2},{value:"Auto Reconnect streams",id:"auto-reconnect-streams",level:2},{value:"Pub-Sub with Streams in Browser",id:"pub-sub-with-streams-in-browser",level:2}],g={toc:d};function h(e){var n=e.components,t=(0,s.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This article is an introduction to using streams with ",(0,r.kt)("a",{parentName:"p",href:"https://pyc8.readthedocs.io/en/latest/"},"pyC8")," and ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/jsc8"},"jsC8")," SDKs."),(0,r.kt)("p",null,"Streams are a type of collection in GDN to capture ",(0,r.kt)("inlineCode",{parentName:"p"},"data-in-motion"),". Messages are sent via streams by publishers to consumers who then do something with the message. Streams can be created via client SDKs (pyC8, jsC8), REST API or the web console."),(0,r.kt)("p",null,"Streams unifies ",(0,r.kt)("inlineCode",{parentName:"p"},"queuing")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"pub-sub messaging")," into a unified messaging model that provides a lot of flexibility to users to consume messages in a way that is best for the use case at hand."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"producer --\x3e stream --\x3e subscription --\x3e consumer")),(0,r.kt)("p",null,"A stream is a named channel for sending messages. Each stream is backed by a ",(0,r.kt)("inlineCode",{parentName:"p"},"distributed append-only")," log and can be ",(0,r.kt)("inlineCode",{parentName:"p"},"local")," (at one edge location only) or ",(0,r.kt)("inlineCode",{parentName:"p"},"global")," (across all edge locations in the Fabric)."),(0,r.kt)("p",null,"Messages from publishers are only stored once on a stream, and can be consumed as many times as necessary by consumers. The stream is the source of truth for consumption. Although messages are only stored once on the stream, there can be different ways of consuming these messages."),(0,r.kt)("p",null,"Consumers are grouped together for consuming messages. Each group of consumers is a subscription on a stream. Each consumer group can have its own way of consuming the messages: exclusively, shared, or failover."),(0,r.kt)("p",null,"Streams provide:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Seamless geo-replication of messages across regions"),(0,r.kt)("li",{parentName:"ul"},"Very low publish and end-to-end latency"),(0,r.kt)("li",{parentName:"ul"},"Seamless scalability to over a million topics"),(0,r.kt)("li",{parentName:"ul"},"Multiple subscription modes (",(0,r.kt)("inlineCode",{parentName:"li"},"exclusive"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"shared"),", and ",(0,r.kt)("inlineCode",{parentName:"li"},"failover"),") for streams"),(0,r.kt)("li",{parentName:"ul"},"Guaranteed message delivery with persistent message storage")),(0,r.kt)("p",null,"Streams are built on the ",(0,r.kt)("em",{parentName:"p"},"publish-subscribe")," pattern, aka pub-sub. In this pattern, producers publish messages to streams. Consumers can then subscribe to those streams, process incoming messages, and send an acknowledgement when processing is complete."),(0,r.kt)("p",null,"Once a subscription has been created, all messages will be retained by Streams, even if the consumer gets disconnected Retained messages will be discarded only when a consumer acknowledges that they've been successfully processed."),(0,r.kt)("p",null,'Messages are the basic "unit" of Streams. They\'re what producers publish to streams and what consumers then consume from streams (and acknowledge when the message has been processed). Messages are the analogue of letters in a postal service system.'),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Component"),(0,r.kt)("th",{parentName:"tr",align:null},"Purpose"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Value / data payload"),(0,r.kt)("td",{parentName:"tr",align:null},"The data carried by the message. All messages carry raw bytes.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Key"),(0,r.kt)("td",{parentName:"tr",align:null},"Messages can optionally be tagged with keys, which can be useful for things like streams compaction")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Properties"),(0,r.kt)("td",{parentName:"tr",align:null},"An optional key/value map of user-defined properties")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Producer Name"),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the producer that produced the message (producers are automatically given default names, but you can apply your own explicitly as well)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Sequence ID"),(0,r.kt)("td",{parentName:"tr",align:null},"Each message belongs to an ordered sequence on its stream. A message's sequence ID is its ordering in that sequence.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Publish Time"),(0,r.kt)("td",{parentName:"tr",align:null},"The timestamp of when the message was published (automatically applied by the producer)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Event Time"),(0,r.kt)("td",{parentName:"tr",align:null},"An optional timestamp that applications can attach to the message representing when something happened, e.g. when the message was processed. The event time of a message is 0 if none is explicitly set.")))),(0,r.kt)("h2",{id:"credentials"},"Credentials"),(0,r.kt)("p",null,"Assume the following credentials:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"tenant name is ",(0,r.kt)("inlineCode",{parentName:"li"},"nemo@nautilus.com"),"."),(0,r.kt)("li",{parentName:"ul"},"user password is ",(0,r.kt)("inlineCode",{parentName:"li"},"xxxxxx"),".")),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"With Yarn or NPM\n\n    yarn add jsc8\n    (or)\n    npm install jsc8\n\nIf you want to use the SDK outside of the current directory, you can also install it globally using the `--global` flag:\n\n    npm install --global jsc8\n\nFrom source,\n\n    git clone https://github.com/macrometacorp/jsc8.git\n    cd jsC8\n    npm install\n    npm run dist\n"))),(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},"pyC8 requires Python 3.5+. Python 3.6 or higher is recommended\n\nTo install pyC8, simply run\n\n    $ pip3 install pyC8\n\nor, if you prefer to use conda:\n\n    conda install -c conda-forge pyC8\n\nor pipenv:\n\n    pipenv install --pre pyC8\n\nOnce the installation process is finished, you can begin developing applications in Python.\n")))),(0,r.kt)("h2",{id:"connect-to-gdn"},"Connect to GDN"),(0,r.kt)("p",null,"The first step in using GDN is to establish a connection to a local region. When this code executes, it initializes the server connection to the region URL you sepcified."),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\n// Simple Way\nconst client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// ----- OR -----\nconst client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n\n\n// To use advanced options\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n'))),(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'from operator import concat\nimport base64\nimport json\nimport warnings\nfrom c8 import C8Client\nimport six\nwarnings.filterwarnings("ignore")\n\nURL = "gdn.paas.macrometa.io"\nGEO_FABRIC = "_system"\nAPI_KEY = "my API key" #Change this to my API key\n\nprint("--- Connecting to C8")\n## Simple Way\nclient = C8Client(protocol=\'https\', host=URL, port=443, apikey = API_KEY, geofabric = GEO_FABRIC)\n\n## To use advanced options\n#client = C8Client(protocol=\'https\', host=\'gdn.paas.macrometa.io\', port=443)\n')))),(0,r.kt)("h2",{id:"get-geofabric-details"},"Get GeoFabric Details"),(0,r.kt)("p",null,"To get details of fabric,"),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\n\n// Crete a authenticated instance with Token / Apikey\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n// await console.log("Authentication done!!...");\n\n// Or use Email & Password to Authenticate client instance\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n\nawait client.login("nemo@nautilus.com", "xxxxxx");\n\nasync function getFabric() {\n  try {\n    await console.log("Getting the fabric details...");\n    let result = await client.get();\n\n    await console.log("result is: ", result);\n  } catch(e){\n    await console.log("Fabric details could not be fetched because "+ e);\n  }\n}\n\ngetFabric();\n'))),(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'print("Get geo fabric details...")\nprint(client.get_fabric_details())\n')))),(0,r.kt)("h2",{id:"create-global--local-streams"},"Create Global & Local Streams"),(0,r.kt)("p",null,"The streams in GDN can be either a local stream or could be a geo-replicated stream."),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\n\n// Crete a authenticated instance with Token / Apikey\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n// await console.log("Authentication done!!...");\n\n// Or use Email & Password to Authenticate client instance\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n\nawait client.login("nemo@nautilus.com", "xxxxxx");\n\nasync function streams() {\n    try{\n      await console.log("Creating local stream...");\n      const stream_local = await client.createStream("testStream-local", true);\n\n      await console.log("Creating global stream...");\n      const stream_global = await client.createStream("testStream-global", false);\n\n      // FOR ADVANCED USER\n      // await console.log("Creating local stream...");\n      // const stream_local = client.stream("testStream-local", true);\n      // await stream.createStream();\n\n      // await console.log("Creating global stream...");\n      // const stream_global = client.stream("testStream-global", false);\n      // await stream.createStream();\n\n    } catch(e){\n      await console.log("Streams could not be fetched because "+ e);\n    }\n}\n\nstreams();\n'))),(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'prefixText = ""\nprefixBool = False\ndemo_stream = \'streamQuickstart\'\n    \n# Get the right prefix for the stream\nif prefixBool:\n    prefixText = "c8locals."\nelse:\n    prefixText = "c8globals."\n\n\nstreamName = {"stream-id": ""}\nif client.has_stream(demo_stream, local = prefixBool):\n    print("Stream already exists")\n    streamName["stream-id"] = concat(prefixText, demo_stream)\n    print ("OLD Producer =",  streamName["stream-id"])\nelse:\n    #print(client.create_stream(demo_stream, local=prefixBool))\n    streamName = client.create_stream(demo_stream, local=prefixBool)\n    print ("NEW Producer =",  streamName["stream-id"])\n\nprint("Get Streams: ", client.get_streams())\n')))),(0,r.kt)("h2",{id:"publish-messages"},"Publish Messages"),(0,r.kt)("p",null,"Example to publish documents to a stream. The stream can be either a local stream or could be a geo-replicated stream."),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8")\n\n// Crete a authenticated instance with Token / Apikey\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n// await console.log("Authentication done!!...");\n\n// Or use Email & Password to Authenticate client instance\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n\nawait client.login("nemo@nautilus.com", "xxxxxx");\n\nasync function streams() {\n    try {\n\n      await console.log("Creating local stream...");\n      await client.createStream("my-stream", true);\n\n      const stream = await client.getStream("my-stream", true);\n      await stream.publishMessage("Hello World");\n\n      /*\n\n      // FOR ADVANCED USER\n      const stream = client.stream("my-stream", true);\n      await stream.createStream();\n\n      const producerOTP = await stream.getOtp();\n      const producer = await stream.producer("gdn.paas.macrometa.io", {\n        otp: producerOTP,\n    });\n      producer.on("open", () => {\n        // If you message is an object, convert the obj to string.\n        // e.g. const message = JSON.stringify({message:\'Hello World\'});\n        const message = "Hello World";\n        const payloadObj = { payload: Buffer.from(message).toString("base64") };\n        producer.send(JSON.stringify(payloadObj));\n      });\n\n      producer.on("message", (msg) => {\n        console.log(msg, "Sent Successfully");\n      });\n\n      */\n\n    } catch(e) {\n      await console.log("Publishing could not be done because "+ e);\n    }\n}\n\nstreams()\n'))),(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'producer = client.create_stream_producer(demo_stream, local=prefixBool)\nfor i in range(10):\n    msg1 = "Persistent Hello from " + "("+ str(i) +")"\n    data = {\n        "payload" : base64.b64encode(six.b(msg1)).decode("utf-8")\n    }\n    print("Stream: ", msg1)\n    print(producer.send(json.dumps(data)))\n')))),(0,r.kt)("h2",{id:"subscribe-to-stream"},"Subscribe to Stream"),(0,r.kt)("p",null,"Example to subscribe documents from a stream. The stream can be either a local stream or could be a geo-replicated stream."),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require(\'jsc8\');\n\n// Crete a authenticated instance with Token / Apikey\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", token: "XXXX", fabricName: \'_system\'});\n// const client = new jsc8({url: "https://gdn.paas.macrometa.io", apiKey: "XXXX", fabricName: \'_system\'});\n// await console.log("Authentication done!!...");\n\n// Or use Email & Password to Authenticate client instance\nconst client = new jsc8("https://gdn.paas.macrometa.io");\n\nawait client.login("nemo@nautilus.com", "xxxxxx");\n\nasync function getDCList() {\n  let dcListAll = await client.listUserFabrics();\n  let dcListObject = await dcListAll.find(function(o) { return o.name === geo_fabric; });\n  return dcListObject.options.dcList.split(",");\n}\n\n(async function() {\n  const dcList = await getDCList();\n  await console.log("dcList: ", dcList);\n  await client.createStream("my-stream", true);\n  //Here the last boolean value tells if the stream is local or global. false means that it is global.\n  // publishing streams\n  const consumer = await client.createStreamReader("my-stream", "my-subscription", true);\n  consumer.on("message", (msg) => {\n    const { payload, messageId } = JSON.parse(msg);\n    // logging received message payload(ASCII encoded) to decode use atob()\n    console.log(payload);\n    // Send message acknowledgement\n    consumer.send(JSON.stringify({ messageId }));\n  });\n\n})();\n'))),(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},"subscriber = client.subscribe(stream=demo_stream, local=prefixBool,\n    subscription_name=\"test-subscription-1\")\nfor i in range(10):\n    print(\"In \",i)\n    m1 = json.loads(subscriber.recv())  # Listen on stream for any receiving messages\n    msg1 = base64.b64decode(m1[\"payload\"])\n    print(F\"Received message '{msg1}' id='{m1['messageId']}'\") # Print the received message\n    subscriber.send(json.dumps({'messageId': m1['messageId']})) # Acknowledge the received message\n")))),(0,r.kt)("h2",{id:"full-demo-quickstart-file"},"Full demo quickstart file"),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'""" This file is a demo to send data to/from a stream """\nfrom operator import concat\nimport base64\nimport json\nimport warnings\nfrom c8 import C8Client\nimport six\nwarnings.filterwarnings("ignore")\n\nURL = "gdn.paas.macrometa.io"\nGEO_FABRIC = "_system"\nAPI_KEY = "my API key" # Change this to your API key\nprefixText = ""\nprefixBool = False\ndemo_stream = \'streamQuickstart\'\n\nclient = C8Client(protocol=\'https\', host=URL, port=443, apikey = API_KEY, geofabric = GEO_FABRIC)\n\n# Get the right prefix for the stream\nif prefixBool:\n    prefixText = "c8locals."\nelse:\n    prefixText = "c8globals."\n\n\ndef createStream():\n    """ This function creates a stream """\n    streamName = {"stream-id": ""}\n    if client.has_stream(demo_stream, local = prefixBool):\n        print("Stream already exists")\n        streamName["stream-id"] = concat(prefixText, demo_stream)\n        print ("OLD Producer =",  streamName["stream-id"])\n    else:\n        #print(client.create_stream(demo_stream, local=prefixBool))\n        streamName = client.create_stream(demo_stream, local=prefixBool)\n        print ("NEW Producer =",  streamName["stream-id"])\n\n# Creating the producer and sending data\ndef sendData():\n    """ This function sends data through a stream """\n    producer = client.create_stream_producer(demo_stream, local=prefixBool)\n    for i in range(10):\n        msg1 = "Persistent Hello from " + "("+ str(i) +")"\n        data = {\n            "payload" : base64.b64encode(six.b(msg1)).decode("utf-8")\n        }\n        print("Stream: ", msg1)\n        print(producer.send(json.dumps(data)))\n\n\n# Creating the subscriber and receiving data\ndef receiveData():\n    """ This function receives data from a stream """\n    subscriber = client.subscribe(stream=demo_stream, local=prefixBool,\n        subscription_name="test-subscription-1")\n    for i in range(10):\n        print("In ",i)\n        m1 = json.loads(subscriber.recv())  # Listen on stream for any receiving messages\n        msg1 = base64.b64decode(m1["payload"])\n        print(F"Received message \'{msg1}\' id=\'{m1[\'messageId\']}\'") # Print the received message\n        subscriber.send(json.dumps({\'messageId\': m1[\'messageId\']})) # Acknowledge the received message\n\n\ncreateStream()\n\n\n# Select choice\nuser_input = input("Type \'w\' or \'1\' to write data. Type \'r\' or \'0\' to read data: ")\nif user_input == "w" or user_input == \'1\':\n    sendData()\nelif user_input == "r" or user_input == \'0\':\n    receiveData()\nelse:\n    print ("Invalid user input. Stopping program")\n')))),(0,r.kt)("h2",{id:"auto-reconnect-streams"},"Auto Reconnect streams"),(0,r.kt)("p",null,"Write a wrapper class to keep the connection alive.\nFollowing is an example for the wrapper class"),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/* -------------------------------------------------------------------------- */\n/*                            Stream Wrapper Class                            */\n/* -------------------------------------------------------------------------- */\n\n/*\n  ...\n  // Consumer websocket example\n  const connection = new StreamWebsocket(()=>stream.consumer(name,url))\n  ...\n  ...\n  ...\n  // Producer websocket example -\n  const connection = new StreamWebsocket(()=>stream.producer(url))\n  ...\n\n*/\n\nclass StreamWebsocket {\n  constructor(ws) {\n    /*  Map for Websocket events */\n    this._listeners = {\n      error: [],\n      message: [],\n      open: [],\n      close: [],\n    };\n\n    /* Determines connection should try to reconnect */\n    this._shouldReconnect = true;\n\n    /* Countet to keep track for the Number for Retries for the connection */\n    this._retryCount = -1;\n\n    /* Number of time it will try to reconnect if error */\n    this._maxRetries = Infinity;\n\n    /* Configuration variables for waiting before re-opening the connection */\n    this._maxReconnectionDelay = 10000;\n    this._minReconnectionDelay = 1000 + Math.random() * 4000;\n    this._reconnectionDelayGrowFactor = 1.3;\n\n    this._connectLock = false;\n    this._ws;\n\n    this._getConnection = ws;\n    this._connect();\n  }\n\n  /* --------------------------------- Helpers -------------------------------- */\n\n  /* Encodes a string in base-64. */\n  _btoa(str) {\n    return Buffer.from(str).toString("base64");\n  }\n\n  /* Method to calculate delay before re-opening the connection */\n  _getNextDelay() {\n    let delay = 0;\n\n    if (this._retryCount > 0) {\n      delay =\n        this._minReconnectionDelay *\n        Math.pow(this._reconnectionDelayGrowFactor, this._retryCount - 1);\n      if (delay > this._maxReconnectionDelay) {\n        delay = this._maxReconnectionDelay;\n      }\n    }\n\n    return delay;\n  }\n  /* Method implements delay by returning a promise to resolve when delay completes   */\n  _wait() {\n    return new Promise((resolve) => {\n      setTimeout(resolve, this._getNextDelay());\n    });\n  }\n\n  /* Method triggers callback function attached to sockets events   */\n  _callEventListener(event, listener) {\n    if (typeof listener === \'function\') {\n      listener(event);\n    }\n  }\n\n  /* Attaching callbacks function sockets events   */\n  _addListeners() {\n    if (!this._ws) {\n      return;\n    }\n\n    this._ws.on("open", this._handleOpen.bind(this));\n    this._ws.on("close", this._handleClose.bind(this));\n    this._ws.on("message", this._handleMessage.bind(this));\n    this._ws.on("error", this._handleError.bind(this));\n  }\n\n  /* Method to be triggered on websocket close  */\n  _handleClose(event) {\n    if (this._shouldReconnect) {\n      this._connect();\n    }\n\n    this._listeners.close.forEach((listener) =>\n      this._callEventListener(event, listener)\n    );\n  }\n\n  /* Method to be triggered on websocket message  */\n  _handleMessage(msg) {\n    const parsedMsg = JSON.parse(msg);\n    this._listeners.message.forEach((listener) =>\n      this._callEventListener(parsedMsg, listener)\n    );\n  }\n\n  /* Method to be triggered on websocket error  */\n  _handleError(event) {\n    this._listeners.error.forEach((listener) =>\n      this._callEventListener(event, listener)\n    );\n  }\n\n  /* Method to be triggered on websocket open  */\n  _handleOpen(event) {\n    this._listeners.open.forEach((listener) =>\n      this._callEventListener(event, listener)\n    );\n  }\n\n  /* Method to open a websocket connection  */\n  _connect() {\n    if ((this._connectLock || !this._shouldReconnect) && this._retryCount > 0) {\n      return;\n    }\n\n    this._connectLock = true;\n\n    this._wait().then(() => {\n      if (this._retryCount >= this._maxRetries) {\n        return;\n      }\n      this._ws = this._getConnection();\n      this._connectLock = false;\n      this._retryCount++;\n      this._addListeners();\n    });\n  }\n\n  /* -------------------------------------------------------------------------- */\n\n  /* Method to attach a callback events to connection */\n  on(type, cb) {\n    if (this._listeners[type]) {\n      this._listeners[type].push(cb);\n    }\n  }\n\n  /* Method to send data to websocket */\n  send(msg) {\n    const msgToSend = JSON.stringify({ payload: this._btoa(msg) });\n    this._ws.send(msgToSend);\n  }\n\n  /* Method to send acknowledgment to websocket */\n  ack(messageId) {\n    this._ws.send(JSON.stringify({ messageId }));\n  }\n\n  /* Method to close a websocket */\n  close() {\n    this._shouldReconnect = false;\n    this._ws.close();\n  }\n}\n\nmodule.exports = StreamWebsocket;\n')))),(0,r.kt)("p",null,"Using the above wrapper we will create a producer and consumer, which has auto reconnect mechanism. Following is a sample code for how to handle keep connection alive"),(0,r.kt)(o.Z,{groupId:"operating-systems",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"js",label:"Javascript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const jsc8 = require("jsc8");\nconst atob = require("atob");\nconst StreamWebsocket = require("./streamWebsocketWrapper");\n\nvar consumer;\nvar producer;\n\n(async function () {\n  try {\n    const client = new jsc8("URL");\n    await client.login("EMAIL", "PASSWORD");\n\n    const stream = client.stream("STREAM_NAME", "IS_GLOBAL_OR_LOCAL_BOOLEAN");\n\n    // -------------------- CONSUMERS --------------------------\n\n    const initConsumer = () => {\n      return new Promise((resolve, reject) => {\n        consumer = new StreamWebsocket(() =>\n          stream.consumer("CONSUMER_NAME", "DC_NAME")\n        );\n\n        consumer.on("close", () => {\n          console.log("consumer-close", new Date());\n        });\n\n        consumer.on("open", () => {\n          console.log("consumer-open", new Date());\n          resolve();\n        });\n\n        consumer.on("message", (msg) => {\n          const payload = atob(msg.payload);\n            consumer.ack(msg.messageId);\n        });\n\n        consumer.on("error", (e) => {\n          console.log("error", e.message);\n        });\n      });\n    };\n\n    // -------------------- PRODUCERS --------------------------\n\n    const initProducer = () => {\n      producer = new StreamWebsocket(() =>\n        stream.producer("DC_NAME")\n      );\n\n      producer.on("open", () => {\n        console.log("producer-open", new Date());\n      });\n\n      producer.on("close", () => {\n        console.log("producer-close", new Date());\n      });\n\n      producer.on("error", (e) => {\n        console.log("error", e.message);\n      });\n    };\n\n    // ----------------- INIT ---------------------------\n\n    initConsumer().then(() => {\n      initProducer();\n    });\n\n  } catch (e) {\n    console.log(e);\n  }\n})();\n')))),(0,r.kt)("h2",{id:"pub-sub-with-streams-in-browser"},"Pub-Sub with Streams in Browser"),(0,r.kt)("p",null,"Example to publish messages on a stream and subscribe to that stream to receive messages, with a simple UI"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>Pub-Sub demo</title>\n    <link\n      href="https://fonts.googleapis.com/css2?family=Overpass+Mono&display=swap"\n      rel="stylesheet"\n    />\n    <link\n      rel="stylesheet"\n      href="//cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.css"\n    />\n    <link\n      rel="stylesheet"\n      href="//cdnjs.cloudflare.com/ajax/libs/milligram/1.3.0/milligram.css"\n    />\n    <style rel="stylesheet">\n      #console {\n        font-family: "Roboto Mono", monospace !important;\n      }\n    </style>\n  </head>\n\n  <body class="container" style="max-width: none;">\n    <div class="row">\n      <div class="column column-40" style="padding: 20px; height: 100vh;">\n        <h1>Pub Sub Demo</h1>\n\n        <textarea\n          rows="10"\n          style="resize: vertical; height: 200px;"\n          placeholder="Enter your message here..."\n          id="messageBox"\n          disabled\n        ></textarea>\n        <div style="display: flex;">\n          <div style="flex-grow: 1;">\n            <button onclick="init()" class="button-outline" id="startButton">\n              Start\n            </button>\n\n            <button\n              onclick="closeConnection()"\n              class="button-clear"\n              disabled\n              id="closeButton"\n            >\n              Close\n            </button>\n          </div>\n\n          <button onclick="publish()" id="publishButton" disabled>\n            Publish\n          </button>\n        </div>\n      </div>\n      <div\n        id="console"\n        class="column column-60"\n        style="padding: 20px; height: 100vh; background: black; overflow: auto;"\n      ></div>\n    </div>\n  </body>\n  <script type="text/javascript">\n    /* ------------------- API MIDDLEWARE TO MANAGE API CALLS ------------------- */\n\n    class APIRequest {\n      _headers = {\n        Accept: "application/json",\n        "Content-Type": "application/json",\n      };\n\n      constructor(url) {\n        this._url = url;\n      }\n\n      login(email, password) {\n        const endpoint = "/_open/auth";\n\n        const self = this;\n\n        return new Promise(function (resolve, reject) {\n          self\n            .req(endpoint, {\n              body: { email, password },\n              method: "POST",\n            })\n            .then(({ jwt, ...data }) => {\n              self._headers.authorization = `bearer ${jwt}`;\n              resolve(data);\n            })\n            .catch(reject);\n        });\n      }\n\n      _handleResponse(response, resolve, reject) {\n        if (response.ok) {\n          resolve(response.json());\n        } else {\n          reject(response);\n        }\n      }\n\n      req(endpoint, { body, ...options } = {}) {\n        const self = this;\n        return new Promise(function (resolve, reject) {\n          fetch(self._url + endpoint, {\n            headers: self._headers,\n            body: body ? JSON.stringify(body) : undefined,\n            ...options,\n          }).then((response) =>\n            self._handleResponse(response, resolve, reject)\n          );\n        });\n      }\n    }\n\n    /* ---------------------------- PUB-SUB TUTORIAL ---------------------------- */\n\n    const EMAIL = "nemo@nautilus.com";\n    const PASSWORD = "xxxxxx";\n\n    const FEDERATION_NAME = "api-gdn.paas.macrometa.io";\n    const FEDERATION_URL = `https://${FEDERATION_NAME}`;\n\n    const STREAM_NAME = "api_tutorial_streams";\n    const CONSUMER_NAME = "api_tutorial_streams_consumer";\n    const IS_GLOBAL = true;\n\n    /* ------------------------------ UI References ----------------------------- */\n\n    const consoleElement = document.getElementById("console");\n    const input = document.getElementById("messageBox");\n    const startButton = document.getElementById("startButton");\n    const closeButton = document.getElementById("closeButton");\n    const publishButton = document.getElementById("publishButton");\n\n    /* ---------------------------- Global Variables ---------------------------- */\n\n    var consumer;\n    var producer;\n\n    /* ---------------------------- Helpers Functions --------------------------- */\n\n    function checkTime(i) {\n      if (i < 10) {\n        i = "0" + i;\n      }\n      return i;\n    }\n\n    function getTime() {\n      var today = new Date();\n      var h = today.getHours();\n      var m = today.getMinutes();\n      var s = today.getSeconds();\n      // add a zero in front of numbers<10\n      m = checkTime(m);\n      s = checkTime(s);\n      return h + ":" + m + ":" + s;\n    }\n\n    function print(msg) {\n      var node = document.createElement("small");\n\n      node.style =\n        "display:block; font-weight:400;color:white;word-break:break-all;position:relative;padding-left:100px";\n      var span = document.createElement("span");\n      span.style = "position:absolute;left:0";\n\n      var time = document.createTextNode(`> ${getTime()} : `);\n\n      span.appendChild(time);\n\n      var textnode = document.createTextNode(`${msg}`);\n      node.appendChild(span);\n      node.appendChild(textnode);\n      consoleElement.appendChild(node);\n      consoleElement.scrollTop = consoleElement.scrollHeight;\n    }\n\n    function toggleUIButtons(\n      skip = { start: false, publish: false, close: false }\n    ) {\n      if (!skip.start) startButton.disabled = !startButton.disabled;\n      if (!skip.publish) publishButton.disabled = !publishButton.disabled;\n      if (!skip.close) closeButton.disabled = !closeButton.disabled;\n      if (!skip.publish) input.disabled = !input.disabled;\n    }\n\n    /* -------------------------------------------------------------------------- */\n\n    const connection = new APIRequest(FEDERATION_URL);\n\n    const init = async function () {\n      try {\n        toggleUIButtons({ publish: true, close: true });\n\n        /* -------------------- Login (nemo@nautilus.com/xxxxxx) -------------------- */\n\n        const { tenant } = await connection.login(EMAIL, PASSWORD);\n\n        print("Login Successfully using");\n        /* ------------------------------ Create Stream ----------------------------- */\n\n        const stream = await connection.req(\n          `/_fabric/_system/streams/${STREAM_NAME}?global=${IS_GLOBAL}`,\n          {\n            body: { name: STREAM_NAME },\n            method: "POST",\n          }\n        );\n\n        print("STREAM CREATED SUCCESSFULLY");\n\n        /* ----------------- Publish and Subscribe message to stream ---------------- */\n\n        const region = IS_GLOBAL ? "c8global" : "c8local";\n        const streamName = `${region}s.${STREAM_NAME}`;\n\n        // FOR gdn use the below snippet\n        // const url = IS_GLOBAL\n        // ? FEDERATION_NAME;\n        // : `api-${streamApp.streamApps[0].regions[0]}.prod.macrometa.io`\n\n        // #URL_REVIEW : If you have changed your FEDERATION_NAME please review the below code and make required changes to the URL\n        const url = IS_GLOBAL\n          ? FEDERATION_NAME;\n          : `api-${streamApp.streamApps[0].regions[0]}.macrometa.io`\n\n        const consumerUrl = `wss://${url}/_ws/ws/v2/consumer/persistent/${tenant}/${region}._system/${streamName}/${CONSUMER_NAME}`;\n\n        const producerUrl = `wss://${url}/_ws/ws/v2/producer/persistent/${tenant}/${region}._system/${streamName}`;\n\n        /* -------------------------- Initalizing Consumer -------------------------- */\n\n        const initConsumer = () => {\n          return new Promise((resolve) => {\n            consumer = new WebSocket(consumerUrl);\n\n            consumer.onopen = function () {\n              print("Consumer is open now for " + streamName);\n              resolve();\n            };\n\n            consumer.onerror = function () {\n              print(\n                "Failed to establish Consumer connection for " + streamName\n              );\n            };\n\n            consumer.onclose = function () {\n              print("Closed Consumer connection for " + streamName);\n            };\n\n            consumer.onmessage = function (message) {\n              var receivedMsg = message.data && JSON.parse(message.data);\n              print(\n                "------------------ Consumer Message Received -----------------"\n              );\n              print(atob(receivedMsg.payload));\n              print(\n                "--------------------------------------------------------------"\n              );\n\n              const ackMsg = { messageId: receivedMsg.messageId };\n              consumer.send(JSON.stringify(ackMsg));\n            };\n          });\n        };\n\n        /* -------------------------- Initalizing Producer -------------------------- */\n\n        const initProducer = () => {\n          producer = new WebSocket(producerUrl);\n\n          producer.onopen = function () {\n            print("Producer is open now for " + streamName);\n          };\n\n          producer.onclose = function (e) {\n            print("Closed Producer connection for " + streamName);\n          };\n\n          producer.onerror = function (e) {\n            print("Failed to establish Producer connection for " + streamName);\n          };\n        };\n\n        initConsumer().then(() => {\n          initProducer();\n          toggleUIButtons({ start: true });\n          print(\n            "--------------------------------------------------------------"\n          );\n          print(\n            "----------YOU CAN NOW START PUBLISHING YOUR MESSAGES----------"\n          );\n          print(\n            "--------------------------------------------------------------"\n          );\n        });\n      } catch (e) {\n        console.error(e);\n      }\n    };\n\n    function publish() {\n      try {\n        const value = input.value.trim().replace(/(\\r\\n|\\n|\\r)/gm, "");\n        let msgToSend = value;\n\n        if (value[0] === "{" && value.slice(-1) === "}") {\n          msgToSend = JSON.stringify(JSON.parse(input.value));\n        }\n\n        producer.send(JSON.stringify({ payload: btoa(msgToSend) }));\n        print(`Sending message....  : ${msgToSend}`);\n        print(`Producer message sent`);\n      } catch (e) {\n        print(e);\n      }\n    }\n\n    async function closeConnection() {\n      toggleUIButtons();\n\n      consumer.close();\n      print("CONSUMER CLOSING...");\n      producer.close();\n      print("PRODUCER CLOSING...");\n\n      await new Promise((resolve) => setTimeout(resolve, 5000));\n\n      /* ------------------------ Unsubscribe from stream. ------------------------ */\n\n      await connection.req(\n        `/_fabric/_system/_api/streams/unsubscribe/${CONSUMER_NAME}`,\n        {\n          method: "POST",\n        }\n      );\n\n      print(`${CONSUMER_NAME} UNSUBSCRIBED SUCCESSFULLY`);\n    }\n  <\/script>\n</html>\n')))}h.isMDXComponent=!0}}]);