"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[37006],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return d}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,m=p(e,["components","mdxType","originalType","parentName"]),c=l(n),d=a,g=c["".concat(s,".").concat(d)]||c[d]||u[d]||i;return n?r.createElement(g,o(o({ref:t},m),{},{components:n})):r.createElement(g,o({ref:t},m))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=c;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:a,o[1]=p;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},61619:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return p},metadata:function(){return l},toc:function(){return u}});var r=n(83117),a=n(80102),i=(n(67294),n(3905)),o=["components"],p={sidebar_position:30,title:"Partition"},s=void 0,l={unversionedId:"cep/query-guide/partition",id:"cep/query-guide/partition",title:"Partition",description:"Partitions divide streams and queries into isolated groups in order to process them in parallel and in isolation. A partition can contain one or more queries and there can be multiple instances where the same queries and streams are replicated for each partition.",source:"@site/docs/cep/query-guide/partition.md",sourceDirName:"cep/query-guide",slug:"/cep/query-guide/partition",permalink:"/docs/cep/query-guide/partition",draft:!1,editUrl:"https://github.com/macrometacorp/docs/edit/master/docs/cep/query-guide/partition.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{sidebar_position:30,title:"Partition"},sidebar:"tutorialSidebar",previous:{title:"Query",permalink:"/docs/cep/query-guide/query"},next:{title:"Table (Collection)",permalink:"/docs/cep/query-guide/table-collection"}},m={},u=[{value:"Inner Stream",id:"inner-stream",level:3},{value:"Purge Partition",id:"purge-partition",level:3}],c={toc:u};function d(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Partitions divide streams and queries into isolated groups in order to process them in parallel and in isolation. A partition can contain one or more queries and there can be multiple instances where the same queries and streams are replicated for each partition."),(0,i.kt)("p",null,"Each partition is tagged with a partition key. Those partitions only process the events that match the corresponding partition key."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Purpose")),(0,i.kt)("p",null,"Partitions allow you to process the events groups in isolation so that event processing can be performed using the same set of queries for each group."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Partition key generation")),(0,i.kt)("p",null,"A partition key can be generated in the following two methods:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Partition by value"),(0,i.kt)("p",{parentName:"li"},"  This is created by generating unique values using input stream attributes."),(0,i.kt)("p",{parentName:"li"},"  ",(0,i.kt)("strong",{parentName:"p"},"Syntax")),(0,i.kt)("pre",null,"partition with ( <expression> of <stream name>, <expression> of <stream name>, ... ) begin <query> <query> ... end; "),(0,i.kt)("p",{parentName:"li"},"  ",(0,i.kt)("strong",{parentName:"p"},"Example")),(0,i.kt)("p",{parentName:"li"},"  This query calculates the maximum temperature recorded within the last 10 events per ",(0,i.kt)("inlineCode",{parentName:"p"},"deviceID"),"."),(0,i.kt)("pre",null,"partition with ( deviceID of TempStream ) begin insert into DeviceTempStream select roomNo, deviceID, max(temp) as maxTemp from TempStream#window.length(10); end;")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Partition by range"),(0,i.kt)("p",{parentName:"li"},"  This is created by mapping each partition key to a range condition of the input streams numerical attribute."),(0,i.kt)("p",{parentName:"li"},"  ",(0,i.kt)("strong",{parentName:"p"},"Syntax")),(0,i.kt)("pre",null,"partition with ( <condition> as <partition key> or <condition> as <partition key> or ... of <stream name>, ... ) begin <query> <query> ... end;"),(0,i.kt)("p",{parentName:"li"},"  ",(0,i.kt)("strong",{parentName:"p"},"Example")),(0,i.kt)("p",{parentName:"li"},"  This query calculates the average temperature for the last 10 minutes per office area."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"partition with ( roomNo >= 1030 as 'serverRoom' or\n                 roomNo < 1030 and roomNo >= 330 as 'officeRoom' or\n                 roomNo < 330 as 'lobby' of TempStream)\nbegin\n    insert into AreaTempStream\n    select roomNo, deviceID, avg(temp) as avgTemp\n    from TempStream#window.time(10 min)\nend;\n")))),(0,i.kt)("h3",{id:"inner-stream"},"Inner Stream"),(0,i.kt)("p",null,'Queries inside a partition block can use inner streams to communicate with each other while preserving partition isolation. Inner streams are denoted by a "#" placed before the stream name, and these streams cannot be accessed outside a partition block.'),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Purpose")),(0,i.kt)("p",null,"Inner streams allow you to connect queries within the partition block so that the output of a query can be used as an input only by another query\nwithin the same partition. Therefore, you do not need to repartition the streams if they are communicating within the partition."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example")),(0,i.kt)("p",null,"This partition calculates the average temperature of every 10 events for each sensor, and sends an output to the ",(0,i.kt)("inlineCode",{parentName:"p"},"DeviceTempIncreasingStream")," stream if the consecutive average temperature values increase by more than\n5 degrees."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"partition with ( deviceID of TempStream )\nbegin\n    insert into #AvgTempStream\n    select roomNo, deviceID, avg(temp) as avgTemp\n    from TempStream#window.lengthBatch(10)\n\n    insert into DeviceTempIncreasingStream\n    select e1.deviceID, e1.avgTemp as initialAvgTemp, e2.avgTemp as finalAvgTemp\n    from every (e1=#AvgTempStream),e2=#AvgTempStream[e1.avgTemp + 5 < avgTemp]\nend;\n")),(0,i.kt)("h3",{id:"purge-partition"},"Purge Partition"),(0,i.kt)("p",null,"Based on the partition key used for the partition, multiple instances of streams and queries will be generated. When an extremely large number of unique partition keys are used there is a possibility of very high instances of streams and queries getting generated and eventually system going out of memory. In order to overcome this, users can define a purge interval to clean partitions that will not be used anymore."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Purpose")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@purge")," allows you to clean the partition instances that will not be used anymore."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Syntax")),(0,i.kt)("p",null,"The syntax of partition purge configuration is as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"@purge(enable='true', interval='<purge interval>', idle.period='<idle period of partition instance>')\npartition with ( <partition key> of <input stream> )\nbegin\n    insert into <output stream>\n    select <attribute name>, <attribute name>, ...\n    from <input stream> ...\nend;\n")),(0,i.kt)("p",null,"When using purge with an Aggregation, use a ",(0,i.kt)("inlineCode",{parentName:"p"},"WITH()")," property instead. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Partition purge configuration"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Purge interval"),(0,i.kt)("td",{parentName:"tr",align:null},"The periodic time interval to purge the purgeable partition instances.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Idle period of partition instance"),(0,i.kt)("td",{parentName:"tr",align:null},"The period, a particular partition instance (for a given partition key) needs to be idle before it becomes purgeable.")))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Examples")),(0,i.kt)("p",null,"Mark partition instances eligible for purging, if there are no events from a particular deviceID for 15 seconds, and periodically purge those partition instances every 1 second."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"@purge(enable='true', interval='1 sec', idle.period='15 sec')\npartition with ( deviceID of TempStream )\nbegin\n    insert into #AvgTempStream\n    select roomNo, deviceID, avg(temp) as avgTemp\n    from TempStream#window.lengthBatch(10)\n\n    insert into DeviceTempIncreasingStream\n    select e1.deviceID, e1.avgTemp as initialAvgTemp, e2.avgTemp as finalAvgTemp\n    from every (e1=#AvgTempStream),e2=#AvgTempStream[e1.avgTemp + 5 < avgTemp]\nend;\n")))}d.isMDXComponent=!0}}]);